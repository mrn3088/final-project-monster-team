<!DOCTYPE html>
<html>
<head>
  <!-- Include ZingGrid, ZingChart, and axios libraries -->
  <script src="https://cdn.zinggrid.com/zinggrid.min.js"></script>
  <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Data Visualization</title>
</head>
<body>
  <!-- Define your ZingGrid for language usage -->
  <zing-grid
    id="languageGrid"
    caption="Language Usage"
    data='[]'>
    <zg-column index="language" header="Language"></zg-column>
    <zg-column index="count" header="Count"></zg-column>
  </zing-grid>

  <!-- Define your ZingChart for average load times -->
  <div id="averageLoadTimeChart"></div>

  <script>
    // Fetch data for browser usage from your Express app
    axios.get('https://cse135.monster/api/static')
      .then(response => {
        let browserData = [];

        let data = response.data;
        let browserCounts = {
          'Chrome': 0,
          'Firefox': 0,
          'Safari': 0,
          'Internet Explorer': 0,
          'Other': 0
        };

        for (let i = 0; i < data.length; i++) {
          let value = data[i];
          let userAgent = value.userAgent;

          if (userAgent.includes('Chrome')) {
            browserCounts['Chrome']++;
          } else if (userAgent.includes('Firefox')) {
            browserCounts['Firefox']++;
          } else if (userAgent.includes('Safari')) {
            browserCounts['Safari']++;
          } else if (userAgent.includes('Internet Explorer')) {
            browserCounts['Internet Explorer']++;
          } else {
            browserCounts['Other']++;
          }
        }

        for (let browserType in browserCounts) {
          browserData.push({
            browserType: browserType,
            count: browserCounts[browserType]
          });
        }

        // Update the ZingGrid with the new data
        document.getElementById('browserGrid').setData(browserData);
      })
      .catch(error => {
        console.error('Error fetching browser data:', error);
      });

    // Fetch data for language activity from your Express app
    axios.get('https://cse135.monster/api/static')
      .then(response => {
        let languageData = [];

        let data = response.data;
        let languageCounts = {
          'en-US': 0,
          'zh-CN': 0
        };

        for (let i = 0; i < data.length; i++) {
          let value = data[i];
          let language = value.language;

          if (language === 'en-US') {
            languageCounts['en-US']++;
          } else if (language === 'zh-CN') {
            languageCounts['zh-CN']++;
          }
        }

        for (let language in languageCounts) {
          languageData.push({
            language: language,
            count: languageCounts[language]
          });
        }

        // Update the ZingGrid with the new data
        document.getElementById('languageGrid').setData(languageData);
      })
      .catch(error => {
        console.error('Error fetching language data:', error);
      });

    // Fetch data for load times from your Express app
    axios.get('https://cse135.monster/api/performance/')
      .then(response => {
        let loadTimeData = {
          "type": "line",
          "series": [
            {"values": []},  // pageStartLoad times
            {"values": []}   // totalLoadTime times
          ]
        };

        let performanceData = response.data;

        for (let i = 0; i < performanceData.length; i++) {
          let value = performanceData[i];
          loadTimeData.series[0].values.push(value.pageStartLoad);
          loadTimeData.series[1].values.push(value.totalLoadTime);
        }

        // Update the ZingChart with the new data
        zingchart.render({
          id: 'load-time-chart',
          data: loadTimeData,
          height: 400,
          width: 600
        });
      })
      .catch(error => {
        console.error('Error fetching performance data:', error);
      });
  </script>
</body>
</html>
