

<!DOCTYPE html>
<html>
<head>
  <!-- Include ZingGrid, ZingChart, and axios libraries -->
  <script src="https://cdn.zinggrid.com/zinggrid.min.js"></script>
  <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Data Visualization</title>
</head>
<body>
  <!-- Define your ZingGrid for Browser usage -->
  <zing-grid
    id="browserGrid"
    caption="Browser Usage"
    data='[]'>
    <zg-column index="browserType" header="Browser Type"></zg-column>
    <zg-column index="count" header="Count"></zg-column>
  </zing-grid>

  <!-- Define your ZingGrid for language usage -->
  <zing-grid
    id="languageGrid"
    caption="Language Usage"
    data='[]'>
    <zg-column index="language" header="Language"></zg-column>
    <zg-column index="jsEnabled" header="JavaScript Enabled"></zg-column>
    <zg-column index="cookieEnabled" header="Cookie Enabled"></zg-column>
  </zing-grid>

  <!-- Define your ZingChart for load times -->
  <div id="load-time-chart"></div>

  <!-- Define your activity data section -->
  <div id="activity">
    <h1>Activity Data Record</h1>
    <div id="userJSCookie"></div>
  </div>

  <script>
    // Initialize arrays to store the counts of each browser type and language
    var browserData = [
      // Your existing browser data here
      { browserType: 'Chrome', count: 0 },
      { browserType: 'Firefox', count: 0 },
      { browserType: 'Safari', count: 0 },
      { browserType: 'Internet Explorer', count: 0 },
      { browserType: 'Other', count: 0 }
    ];

    // Fetch data for browser usage from your Express app
    axios.get('https://cse135.monster/api/static')
      .then(response => {
        // Your existing logic for browserData here
        var records = response.data;
        if (!Array.isArray(records)) {
          console.error('Response data is not an array:', records);
          return;
        }
        for (var i = 0; i < records.length; i++) {
          var userAgent = records[i].userAgent;
          if (userAgent.includes('Chrome')) {
            data[0].count++;
          } else if (userAgent.includes('Firefox')) {
            data[1].count++;
          } else if (userAgent.includes('Safari')) {
            data[2].count++;
          } else if (userAgent.includes('Internet Explorer')) {
            data[3].count++;
          } else {
            data[4].count++;
          }
        }
        // Update the ZingGrid with the new data
        document.getElementById('browserGrid').setData(browserData);
      })
      .catch(error => {
        console.error('Error fetching browser data:', error);
      });

    // Fetch data for language activity from your Express app
    axios.get('https://cse135.monster/api/static')
      .then(response => {
        let en_JS = 0, zh_JS = 0;
        let en_cookie = 0, zh_cookie = 0;
        let data = response.data;
        for(let i = 0; i < data.length; i++) {
          let value = data[i];
          if (value["language"] === "en-US") {
            if (value["jsEnabled"] === 1) {
              en_JS++;
            }
            if (value["cookieEnabled"] === 1) {
              en_cookie++;
            }
          } else if (value["language"] === "zh-CN") {
            if (value["jsEnabled"] === 1) {
              zh_JS++;
            }
            if (value["cookieEnabled"] === 1) {
              zh_cookie++;
            }
          }
        }

        // Create a table to display the language activity data
        var activityTable = `
          <table>
            <tr>
              <th>Language</th>
              <th>JavaScript Enabled</th>
              <th>Cookie Enabled</th>
            </tr>
            <tr>
              <td>en-US</td>
              <td>${en_JS}</td>
              <td>${en_cookie}</td>
            </tr>
            <tr>
              <td>zh-CN</td>
              <td>${zh_JS}</td>
              <td>${zh_cookie}</td>
            </tr>
          </table>
        `;

        // Display the activity table in the 'userJSCookie' div
        document.getElementById('userJSCookie').innerHTML = activityTable;
      })
      .catch(error => {
        console.error('Error fetching activity data:', error);
      });

    axios.get('https://cse135.monster/api/performance/')
      .then(response => {
        let loadTimeData = {
          "type": "line",
          "series": [
            {"values": []},  // pageStartLoad times
            {"values": []}   // totalLoadTime times
          ]
        };
        let data = response.data;
        for(let i = 0; i < data.length; i++) {
          let value = data[i];
          loadTimeData.series[0].values.push(value['pageStartLoad']);
          loadTimeData.series[1].values.push(value['totalLoadTime']);
        }
        
        // Update the ZingChart with the new data
        zingchart.render({
          id: 'load-time-chart',
          data: loadTimeData,
          height: 400,
          width: 600
        });
      })
      .catch(error => {
        console.error('Error fetching performance data:', error);
      });
  </script>
</body>
</html>
